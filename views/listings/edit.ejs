<% layout('/layout/boilerplate') -%>
<div class="row mt-3">
<div class="col-8 offset-2">

<h3 class="mt-4">Edit Your Listing</h3>

<form 
method="POST"
 action="/listings/<%= listing._id %>?_method=PUT" 
 class="mt-3 needs-validation" 
 novalidate
 enctype="multipart/form-data"  >

    <div class="mb-3">
        <label class="form-label">Title</label>
        <input 
            name="listing[title]" 
            value="<%= listing.title %>" 
            type="text" 
            class="form-control"
            required
        />
        <div class="valid-feedback">Title looks good!</div>
    </div>

    <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea 
            name="listing[description]" 
            class="form-control"
            required
        ><%= listing.description %></textarea>
        <div class="invalid-feedback">Description should be valid</div>
    </div>

    <div class="mb-3">
        Original Listing Image <br>
        <img src="<%= originalImageUrl %>" />
    </div>


    <div class="mb-3">
        <label for="image" class="form-label">Upload Images</label>
        <!-- IMPORTANT: matches your schema image.url -->
        <input 
            name="listing[image]" 
            type="file"
            class="form-control"
        />
    </div>
       
    <div class="mb-3">
  <label class="form-label fw-semibold">Categories</label>

  <div class="row">
    <% 
      const categories = [
        "Trending",
        "Rooms",
        "Farms",
        "Iconic Cities",
        "Pools",
        "Beach",
        "Pet-friendly",
        "Arctic",
        "Sunrise",
        "Horse Riding"
      ]; 
    %>

    <% categories.forEach((cat, index) => { 
      const id = "cat-" + cat.replace(/\s+/g, "-").toLowerCase();
    %>
      <div class="col-4 form-check mb-2">
        <input
          class="form-check-input"
          type="checkbox"
          name="listing[category][]"
          value="<%= cat %>"
          id="<%= id %>"
          <%= listing.category && listing.category.includes(cat) ? "checked" : "" %>
          <%= index === 0 ? "required" : "" %>
        >
        <label class="form-check-label" for="<%= id %>">
          <%= cat %>
        </label>
      </div>
    <% }) %>
  </div>

  <div class="invalid-feedback d-block">
    Select at least one categ


    <div class="mb-3">
        <label class="form-label">Price</label>
        <input 
            name="listing[price]" 
            value="<%= listing.price %>" 
            type="number" 
            class="form-control"
            required
        />
        <div class="invalid-feedback">Price should be valid</div>
    </div>

    <div class="mb-3">
        <label class="form-label">Country</label>
        <input 
            name="listing[country]" 
            value="<%= listing.country %>" 
            type="text" 
            class="form-control"
            required
        />
        <div class="invalid-feedback">Country should be valid</div>
    </div>

    <div class="mb-3">
        <label class="form-label">Location</label>
        <input 
            name="listing[location]" 
            value="<%= listing.location %>" 
            type="text" 
            class="form-control"
            required
        />
        <div class="invalid-feedback">Location should be valid</div>
    </div>

    <button class="btn btn-dark edit-btns mt-3">Save Changes</button>
</form>
<br><br>
</div>
</div>