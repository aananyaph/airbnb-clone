<% layout('/layout/boilerplate') -%>

<body class="p-4">

    <h2><%= listing.title %></h2>

    <!-- IMAGE -->
    <img 
        src="<%= listing.image.url %>" 
        alt="listing image"
        style="width: 100%; max-width: 450px; height: 300px; object-fit: cover; border-radius: 10px;"
    />

    <ul class="mt-3">
        <li><strong>Description:</strong> <%= listing.description %></li>
        <li><strong>Price:</strong> â‚¹<%= listing.price ? listing.price.toLocaleString("en-IN") : "N/A" %> / night
</li>
        <li><strong>Location:</strong> <%= listing.location %></li>
        <li><strong>Country:</strong> <%= listing.country %></li>
    </ul>

    <br>
<div class="row mt-2 md-3" style="margin-bottom: 1rem">
    <div class="col-auto">
        <a href="/listings/<%= listing._id %>/edit" class="btn btn-warning">
            Edit
        </a>
    </div>

    <div class="col-auto">
        <form method="POST" action="/listings/<%= listing._id %>?_method=DELETE">
            <button class="btn btn-danger">
                Delete
            </button>
        </form>
    </div>
</div>
<hr/>
<div class="col-8 offset-3 mb-3">
<h4>Leave a Review</h4>
    <form action="/listings/<%= listing.id %>/reviews" method="POST"
         novalidate class="needs-validation ">
        <div class="mb-3 mt-3">
        <label for="rating" class="form-label">Rating:</label>
        <input type="range" id="rating" name="review[rating]" min="1" max="5"  class="form-range" required>
        </div>
        <div>
            <label for="comment" class="form-label">Comments</label>
            <textarea id="comment" name="review[comment]" class="form-control" rows="5" cols="30" required></textarea>
        <div class="invalid-feedback">Please add some comments for review </div>
        
        </div>
        <button class="btn btn-primary mt-2" type="submit">
            Submit Review
        </button>
    </form>
</div>


<hr/>
<h4>All Reviews</h4>
<% for (let review of listing.reviews) { %>
    <div class="card mb-3" style="width: 50%;">
        <div class="card-body">
            <h5 class="card-title">Jane Doe</h5>
            <p class="card-text">Rating: <%= review.rating %> / 5</p>
            <p class="card-text"><%= review.comment %></p>
        </div>

        <form method="POST" 
              action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" 
              class="mb-3">
            <button class="btn btn-sm btn-dark">Delete</button>
        </form>
    </div>
<% } %>


</body>
