<% layout('/layout/boilerplate') -%>
<style>
    .review-user {
  font-weight: 600;
  font-size: 0.9rem;
}

.rating-title {
  font-size: 0.75rem;
  color: #6b7280; /* subtle gray */
}

.card-text {
  font-size: 0.9rem;
}

</style>
<body class="p-4">

    <h2><%= listing.title %></h2>

    <!-- IMAGE -->
    <img 
        src="<%= listing.image.url %>" 
        alt="listing image"
        style="width: 100%; max-width: 450px; height: 300px; object-fit: cover; border-radius: 10px;"
    />

    <ul class="mt-3">
        <li>
  <strong>Owner:</strong>
  <%= listing.owner ? listing.owner.username : "Unknown" %>
</li>

        <li><strong>Description:</strong> <%= listing.description %></li>
        <li><strong>Price:</strong> â‚¹<%= listing.price ? listing.price.toLocaleString("en-IN") : "N/A" %> / night
</li>
        <li><strong>Location:</strong> <%= listing.location %></li>
        <li><strong>Country:</strong> <%= listing.country %></li>
    </ul>
    <br>
    <% if(currUser && currUser._id.equals(listing.owner._id)) { %>
    <div class="row mt-2 md-3" style="margin-bottom: 1rem">
    <div class="col-auto">
        <a href="/listings/<%= listing._id %>/edit" class="btn btn-warning">
            Edit
        </a>
    </div>

    <div class="col-auto">
        <form method="POST" action="/listings/<%= listing._id %>?_method=DELETE">
            <button class="btn btn-danger">
                Delete
            </button>
        </form>
    </div>
    <% } %>
</div>



<div class="col-8 offset-3 mb-3">
    
    <% if(currUser) { %>
<h4>Leave a Review</h4>
 <form action="/listings/<%= listing.id %>/reviews" method="POST" novalidate class="needs-validation ">
<div class="mb-3 mt-3">

 <label for="rating" class="form-label">Rating:</label>
<fieldset class="starability-heart">
  <!-- <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="0" checked aria-label="No rating." /> -->
  <input type="radio" id="first-rate1" name="review[rating]" value="1" />
  <label for="first-rate1" title="Terrible">1 star</label>
  <input type="radio" id="first-rate2" name="review[rating]" value="2" />
  <label for="first-rate2" title="Not good">2 stars</label>
  <input type="radio" id="first-rate3" name="review[rating]" value="3" />
  <label for="first-rate3" title="Average">3 stars</label>
  <input type="radio" id="first-rate4" name="review[rating]" value="4" />
  <label for="first-rate4" title="Very good">4 stars</label>
  <input type="radio" id="first-rate5" name="review[rating]" value="5" />
  <label for="first-rate5" title="Amazing">5 stars</label>
</fieldset>
</div>

        <div>
            <label for="comment" class="form-label">Comments</label>
            <textarea id="comment" name="review[comment]" class="form-control" rows="5" cols="30" required></textarea>
        <div class="invalid-feedback">Please add some comments for review </div>
        </div>
        <button class="btn btn-primary mt-2" type="submit">
            Submit Review
        </button>
    </form>
</div>
<% } %>

<hr/>
<h4>All Reviews</h4>

<% for (let review of listing.reviews) { %>
  <div class="card col-5 mb-3" style="width: 50%;">
    <div class="card-body">

      <!-- âœ… Reviewer name -->
      <h6 class="review-user mb-1">
        @<%= review.author ? review.author.username : "Anonymous" %>
      </h6>

      <!-- âœ… Smaller rating label -->
      <p class="rating-title mb-1">
        Rated element
      </p>

      <!-- â­ Star rating -->
      <p class="starability-result card-text" data-rating="<%= review.rating %>"></p>

      <!-- ðŸ’¬ Review text -->
      <p class="card-text">
        <%= review.comment %>
      </p>

    </div>

    <!-- ðŸ—‘ Delete button -->
    <form
      method="POST"
      action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE"
      class="mb-3 ms-3"
    >
      <button class="btn btn-sm btn-dark">Delete</button>
    </form>
  </div>
<% } %>


</body>
